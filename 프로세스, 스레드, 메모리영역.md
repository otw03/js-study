# 프로세스, 스레드, 메모리영역, static

# **프로세스(process)란?**

프로세스(process)란 단순히 실행 중인 프로그램(program)  

즉, 사용자가 작성한 프로그램이 운영체제에 의해 메모리 공간을 할당받아 실행 중인 것.  

이러한 프로세스는 프로그램에 사용되는 데이터와 메모리 등의 자원 그리고 스레드로 구성.  

# **스레드(thread)란?**

어떠한 프로그램 내에서, 특히 프로세스 내에서 실행되는 흐름의 단위.  

스레드(thread)란 프로세스(process) 내에서 실제로 작업을 수행하는 주체를 의미합니다.  

할당받은 자원을 이용하는 실행의 단위. 프로세스 내에 여러개 생길 수 있다. 

모든 프로세스에는 한 개 이상의 스레드가 존재하여 작업을 수행합니다.  

또한, 두 개 이상의 스레드를 가지는 프로세스를 멀티스레드 프로세스(multi-threaded process)라고 합니다.  

# ****프로세스와 스레드의 비교****

멀티프로세스와 멀티스레드는 양쪽 모두 여러 흐름이 동시에 진행된다는 공통점을 가지고 있다.  

하지만 `멀티프로세스`**에서 각 프로세스는 독립적으로 실행**되며 **각각 별개의 메모리를 차지**하고 있는 것과 달리 `멀티스레드`**는 프로세스 내의 메모리를 공유**해 사용할 수 있다.  

프로세스 간의 전환 속도보다 스레드 간의 전환 속도가 빠르다.  

## ****멀티 프로세스(Multi Process)****

- 두개 이상 다수의 프로세서(`CPU`)가 협력적으로 하나 이상의 작업(`Task`)을 동시에 처리하는 것이다. (병렬처리)
- 각 프로세스 간 메모리 구분이 필요하거나 독립된 주소 공간을 가져야 할 경우 사용한다.

****장점****  

- 독립된 구조로 안전성이 높은 장점이 있다.
- 프로세스 중 하나에 문제가 생겨도 다른 프로세스에 영향을 주지 않아, 작업속도가 느려지는 손해정도는 생기지만 정지되거나 하는 문제는 발생하지 않는다.
- 여러개의 프로세스가 처리되어야 할 때 동일한 데이터를 사용하고, 이러한 데이터를 하나의 디스크에 두고 모든 프로세서(`CPU`)가 이를 공유하면 비용적으로 저렴하다.

****문제점****  

- 독립된 메모리 영역이기 때문에 작업량이 많을수록( `Context Switching`이 자주 일어나서 주소 공간의 공유가 잦을 경우) 오버헤드가 발생하여 성능저하가 발생 할 수 있다.
- `Context Switching` 과정에서 캐시 메모리 초기화 등 무거운 작업이 진행되고 시간이 소모되는 등 오버헤드가 발생한다.

****Context Switching****  

- `CPU`는 한번에 하나의 프로세스만 실행 가능하다.
- `CPU`에서 여러 프로세스를 돌아가면서 작업을 처리하는 데 이 과정을 `Context Switching`라 한다.
- 구체적으로, 동작 중인 프로세스가 대기를 하면서 해당 프로세스의 상태(`Context`)를 보관하고, 대기하고 있던 다음 순서의 프로세스가 동작하면서 이전에 보관했던 프로세스의 상태를 복구하는 작업을 말한다.

## ****멀티 스레드(Multi Thread)****

- 하나의 프로세스에 여러 스레드로 자원을 공유하며 작업을 나누어 수행하는 것이다.

****장점****  

- 시스템 자원소모 감소 (자원의 효율성 증대)
    - 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어 자원을 효율적으로 관리할 수 있다.
- 시스템 처리율 향상 (처리비용 감소)
    - 스레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어든다.
    - 스레드 사이 작업량이 작아 `Context Switching`이 빠르다. (캐시 메모리를 비울 필요가 없다.)
- 간단한 통신 방법으로 프로그램 응답시간 단축
    - 스레드는 프로세스 내 스택영역을 제외한 메모리 영역을 공유하기에 통신 비용이 적다.
    - 힙 영역을 공유하므로 데이터를 주고 받을 수 있다.

****문제점****  

- 자원을 공유하기에 동기화 문제가 발생할 수 있다. (병목현상, 데드락 등)
- 주의 깊은 설계가 필요하고 디버깅이 어렵다. (불필요 부분까지 동기화하면, 대기시간으로 인해 성능저하 발생)
- 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받는다.
- 단일 프로세스 시스템의 경우 효과를 기대하기 어렵다

- 멀티스레드의 장점
    - CPU가 여러 개일 경우에 각각의 CPU가 스레드 하나씩을 담당하는 방법으로 속도를 높일 수 있다.  
    이러한 시스템에서는 여러 스레드가 실제 시간상으로 동시에 수행될 수 있기 때문이다.
- 멀티스레드의 단점
    - 각각의 스레드 중 어떤 것이 먼저 실행될지 그 순서를 알 수 없다는 것  
    스레드가 실행될 때 어떤 스레드가 먼저 실행될지는 보장되지 않는다.
    - 원래 프로그램의 의도와 다를 수 있다.
    - 스레드의 실행 조건에 따라 결과가 다르게 나오므로, 오류가 발생했을 때 원인을 찾기가 힘들다.  
    이러한 문제를 경쟁조건이라고 하며,  
    문제를 막기 위해 세마포어와 같은 방법을 통해  
    공유 데이터에 접근하는 스레드의 개수를 한개 이하로 유지하는 방법을 사용할 수 있다.
    
    **경쟁조건**  
    
    • 공유 자원에 대해 여러 개의 프로세스가 동시에 접근을 시도할 때 접근의 타이밍이나 순서 등이 결과값에 영향을 줄 수 있는 상태
    
    ---
    
    # 프로세스
    
    프로그램이 실행되는 상태
    
    메모리가 할당되어 실행되는 상태
    
    프로세스 > 스레드
    프로세스가 스레드를 포함한다
    
    독립적으로 실행된다
    
    # 스레드
    
    프로세스에서 실행되는 흐름.
    
    프로세스에 할당된 자원을 할당받는다
    
    프로세스가 종료되면 스레드도 종료된다
    
    # 메모리영역
    
    코드영역, 데이터영역, 힙영역, 스택영역 으로 이루어져 있다
    
    - 코드영역 : 실행할 프로그램 코드
    - 데이터영역 : 프로그램의 시작과 함께 할당되며 프로그램이 종료되면 소멸.  
    전역변수, 정적변수(static)
    - 힙영역 : 런타임에 크기 결정.
    - 스택영역 : 컴파일 타임에 크기 결정. 지역변수가 저장되고 함수가 종료되면 할당되었던 영역이 사라진다.
    
    # static
    
    - 정적변수
    - 프로그램의 시작과 함께 할당된다.
    - 정적으로 할당.
    - 프로그램이 종료될 때까지 변수의 수명이 유지된다.
    
    지역변수 : 코드가 실행될 때 메모리가 할당된다.  호출된 함수가 종료되면 소멸됨.